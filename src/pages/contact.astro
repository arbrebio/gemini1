---
import Layout from "../layouts/Layout.astro";
import FormValidation from "../components/FormValidation.astro";
import LoadingSpinner from "../components/LoadingSpinner.astro";
import { config } from "../lib/config";

const offices = config.contact.offices;
---

<Layout
  title="Contact Us - Get Expert Agricultural Solutions"
  description="Contact Arbre Bio Africa for expert consultation on greenhouse technology, irrigation systems, and precision farming solutions. Transform your agricultural business today."
>
  <!-- Hero Section -->
  <section class="relative h-[40vh] flex items-center">
    <div class="absolute inset-0 z-0">
      <img
        src="https://imgur.com/YyhVyLx.jpg"
        alt="Contact Arbre Bio"
        class="w-full h-full object-cover"
      />
      <div class="absolute inset-0 bg-black bg-opacity-50"></div>
    </div>
    <div class="container mx-auto px-4 relative z-10">
      <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">Contact Us</h1>
      <p class="text-xl text-white max-w-2xl">
        Get expert advice on transforming your agricultural business
      </p>
    </div>
  </section>

  <!-- Contact Form Section -->
  <section class="py-20">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
        <!-- Contact Form -->
        <div class="bg-white p-8 rounded-lg shadow-lg">
          <h2 class="text-3xl font-bold mb-6">Send Us a Message</h2>
          <form class="space-y-6" id="contact-form">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label
                  for="firstName"
                  class="block text-sm font-medium text-gray-700 mb-1"
                >
                  First Name *
                </label>
                <input
                  type="text"
                  id="firstName"
                  name="firstName"
                  required
                  class="w-full px-4 py-2 rounded-md border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
                />
              </div>
              <div>
                <label
                  for="lastName"
                  class="block text-sm font-medium text-gray-700 mb-1"
                >
                  Last Name *
                </label>
                <input
                  type="text"
                  id="lastName"
                  name="lastName"
                  required
                  class="w-full px-4 py-2 rounded-md border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
                />
              </div>
            </div>

            <div>
              <label
                for="email"
                class="block text-sm font-medium text-gray-700 mb-1"
              >
                Email Address *
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-4 py-2 rounded-md border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
              />
            </div>

            <div>
              <label
                for="phone"
                class="block text-sm font-medium text-gray-700 mb-1"
              >
                Phone Number *
              </label>
              <input
                type="tel"
                id="phone"
                name="phone"
                required
                class="w-full px-4 py-2 rounded-md border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
              />
            </div>

            <div>
              <label
                for="interest"
                class="block text-sm font-medium text-gray-700 mb-1"
              >
                I'm interested in *
              </label>
              <select
                id="interest"
                name="interest"
                required
                class="w-full px-4 py-2 rounded-md border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
              >
                <option value="">Select an option</option>
                <option value="Greenhouses">Greenhouses</option>
                <option value="Irrigation Systems">Irrigation Systems</option>
                <option value="Growing Media">Growing Media</option>
                <option value="Project Management">Project Management</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div>
              <label
                for="message"
                class="block text-sm font-medium text-gray-700 mb-1"
              >
                Message *
              </label>
              <textarea
                id="message"
                name="message"
                rows="4"
                required
                class="w-full px-4 py-2 rounded-md border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
              ></textarea>
            </div>

            <button
              type="submit"
              class="w-full bg-primary text-white px-8 py-3 rounded-md hover:bg-primary-600 transition-colors duration-300 flex items-center justify-center"
              aria-describedby="submit-help"
            >
              <span class="mr-2">Send Message</span>
              <span class="loading-spinner hidden ml-2">
                <LoadingSpinner size="sm" color="white" />
              </span>
            </button>

            <p id="submit-help" class="text-sm text-gray-600 mt-2">
              We'll respond within 24-48 hours
            </p>

            <div
              class="success-message hidden bg-green-50 text-green-800 p-4 rounded-md"
              role="alert"
              aria-live="polite"
            >
              Thank you for your message! We'll get back to you soon.
            </div>

            <div
              class="error-message hidden bg-red-50 text-red-800 p-4 rounded-md"
              role="alert"
              aria-live="assertive"
            >
            </div>
          </form>

          <!-- Form Validation Component -->
          <FormValidation
            formId="contact-form"
            rules={[
              {
                field: "firstName",
                required: true,
                type: "text",
                maxLength: 50,
              },
              {
                field: "lastName",
                required: true,
                type: "text",
                maxLength: 50,
              },
              { field: "email", required: true, type: "email", maxLength: 100 },
              { field: "phone", required: true, type: "phone", maxLength: 20 },
              { field: "interest", required: true, type: "text" },
              {
                field: "message",
                required: true,
                type: "text",
                minLength: 10,
                maxLength: 1000,
              },
            ]}
          />
        </div>

        <!-- Contact Information -->
        <div class="space-y-8">
          <div>
            <h2 class="text-3xl font-bold mb-6">Our Offices</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              {
                offices.map((office) => (
                  <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-xl font-bold mb-2">
                      {office.city}, {office.country}
                    </h3>
                    <div class="space-y-3 text-gray-600">
                      <p>{office.address}</p>
                      <p>
                        <a
                          href={`tel:${office.phone.replace(/\s+/g, "")}`}
                          class="hover:text-primary transition-colors"
                        >
                          {office.phone}
                        </a>
                      </p>
                      <p>
                        <a
                          href={`mailto:${office.email}`}
                          class="hover:text-primary transition-colors"
                        >
                          {office.email}
                        </a>
                      </p>
                      <p>{office.hours}</p>
                    </div>
                  </div>
                ))
              }
            </div>
          </div>

          <!-- WhatsApp CTA -->
          <div class="bg-[#25D366] text-white p-8 rounded-lg shadow-lg">
            <h3 class="text-2xl font-bold mb-4">Need Immediate Assistance?</h3>
            <p class="mb-6">
              Chat with our agricultural experts on WhatsApp for quick
              responses.
            </p>
            <a
              href={`https://wa.me/${config.contact.whatsappNumber.replace("+", "")}`}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center bg-white text-[#25D366] px-6 py-3 rounded-md hover:bg-opacity-90 transition-colors"
            >
              <i class="fab fa-whatsapp text-xl mr-2"></i>
              Chat on WhatsApp
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    import { handleFormSubmission } from "../lib/errorHandling";

    const form = document.getElementById(
      "contact-form",
    ) as HTMLFormElement | null;
    const successMessage = form ? form.querySelector(".success-message") : null;
    const errorMessage = form ? form.querySelector(".error-message") : null;
    const loadingSpinner = form ? form.querySelector(".loading-spinner") : null;
    const submitButton = form
      ? (form.querySelector(
          'button[type="submit"]',
        ) as HTMLButtonElement | null)
      : null;

    if (form) {
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Reset messages
        successMessage?.classList.add("hidden");
        errorMessage?.classList.add("hidden");

        // Show loading state
        loadingSpinner?.classList.remove("hidden");
        if (submitButton) {
          submitButton.disabled = true;
          submitButton.setAttribute("aria-busy", "true");
        }

        try {
          const formData = new FormData(form);
          const data = {
            firstName: formData.get("firstName"),
            lastName: formData.get("lastName"),
            email: formData.get("email"),
            phone: formData.get("phone"),
            interest: formData.get("interest"),
            message: formData.get("message"),
          };

          const result = await handleFormSubmission("/api/contact", data, {
            successMessage:
              "Thank you for your message! We'll get back to you soon.",
            onSuccess: () => {
              if (successMessage) {
                successMessage.classList.remove("hidden");
              }
              (form as HTMLFormElement).reset();
            },
            onError: (error) => {
              if (errorMessage) {
                errorMessage.textContent = error;
                errorMessage.classList.remove("hidden");
              }
            },
          });
        } catch (error) {
          if (errorMessage) {
            errorMessage.textContent =
              error instanceof Error
                ? error.message
                : "An error occurred. Please try again.";
            errorMessage.classList.remove("hidden");
          }
        } finally {
          // Reset loading state
          loadingSpinner?.classList.add("hidden");
          if (submitButton) {
            (submitButton as HTMLButtonElement).disabled = false;
            submitButton.removeAttribute("aria-busy");
          }
        }
      });
    }
  </script></Layout
>
