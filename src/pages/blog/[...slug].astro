---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
};
---

<Layout
  title={post.data.title}
  description={post.data.description}
>
  <article class="max-w-4xl mx-auto px-4 py-16">
    <img 
      src={post.data.image}
      alt={post.data.title}
      class="w-full h-[400px] object-cover rounded-lg mb-8"
    />
    <div class="prose prose-lg max-w-none">
      <div class="flex items-center mb-8">
        <span class="text-gray-500">{formatDate(post.data.pubDate)}</span>
        <span class="mx-2">•</span>
        <span class="text-primary capitalize">{post.data.category.replace('-', ' ')}</span>
        <span class="mx-2">•</span>
        <span class="text-gray-500">By {post.data.author}</span>
      </div>
      <h1 class="text-4xl font-bold mb-8">{post.data.title}</h1>
      <Content />
    </div>
    
    <!-- Share on Social Media -->
    <div class="container mx-auto px-4 mt-8">
      <div class="max-w-4xl mx-auto">
        <h3 class="text-xl font-bold mb-4">Share This Article</h3>
        <div class="flex flex-wrap gap-4">
          <a 
            href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(Astro.url.href)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-[#1877F2] text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors inline-flex items-center"
            aria-label="Share on Facebook"
          >
            <i class="fa-brands fa-facebook-f mr-2"></i>
            Facebook
          </a>
          <a 
            href={`https://twitter.com/intent/tweet?url=${encodeURIComponent(Astro.url.href)}&text=${encodeURIComponent(post.data.title)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-[#1DA1F2] text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors inline-flex items-center"
            aria-label="Share on Twitter"
          >
            <i class="fa-brands fa-twitter mr-2"></i>
            Twitter
          </a>
          <a 
            href={`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(Astro.url.href)}&title=${encodeURIComponent(post.data.title)}&summary=${encodeURIComponent(post.data.description)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-[#0A66C2] text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors inline-flex items-center"
            aria-label="Share on LinkedIn"
          >
            <i class="fa-brands fa-linkedin-in mr-2"></i>
            LinkedIn
          </a>
          <a 
            href={`https://wa.me/?text=${encodeURIComponent(`${post.data.title} - ${Astro.url.href}`)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-[#25D366] text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors inline-flex items-center"
            aria-label="Share on WhatsApp"
          >
            <i class="fa-brands fa-whatsapp mr-2"></i>
            WhatsApp
          </a>
          <a 
            href="https://instagram.com/arbrebio"
            target="_blank"
            rel="noopener noreferrer"
            class="bg-[#E4405F] text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors inline-flex items-center"
            aria-label="Follow us on Instagram"
          >
            <i class="fa-brands fa-instagram mr-2"></i>
            Instagram
          </a>
          <a 
            href={`mailto:?subject=${encodeURIComponent(post.data.title)}&body=${encodeURIComponent(`Check out this article: ${Astro.url.href}`)}`}
            class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors inline-flex items-center"
            aria-label="Share via Email"
          >
            <i class="fa-solid fa-envelope mr-2"></i>
            Email
          </a>
        </div>
      </div>
    </div>
    
    <!-- Share on Social Media -->
    <div class="container mx-auto px-4 mt-8">
      <div class="max-w-4xl mx-auto">
        <h3 class="text-xl font-bold mb-4">Share This Article</h3>
        <div class="flex flex-wrap gap-4">
          <a 
            href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(Astro.url.href)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-[#1877F2] text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors inline-flex items-center"
            aria-label="Share on Facebook"
          >
            <i class="fa-brands fa-facebook-f mr-2"></i>
            Facebook
          </a>
          <a 
            href={`https://twitter.com/intent/tweet?url=${encodeURIComponent(Astro.url.href)}&text=${encodeURIComponent(post.data.title)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-[#1DA1F2] text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors inline-flex items-center"
            aria-label="Share on Twitter"
          >
            <i class="fa-brands fa-twitter mr-2"></i>
            Twitter
          </a>
          <a 
            href={`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(Astro.url.href)}&title=${encodeURIComponent(post.data.title)}&summary=${encodeURIComponent(post.data.description)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-[#0A66C2] text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors inline-flex items-center"
            aria-label="Share on LinkedIn"
          >
            <i class="fa-brands fa-linkedin-in mr-2"></i>
            LinkedIn
          </a>
          <a 
            href={`https://wa.me/?text=${encodeURIComponent(`${post.data.title} - ${Astro.url.href}`)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-[#25D366] text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors inline-flex items-center"
            aria-label="Share on WhatsApp"
          >
            <i class="fa-brands fa-whatsapp mr-2"></i>
            WhatsApp
          </a>
          <a 
            href="https://instagram.com/arbrebio"
            target="_blank"
            rel="noopener noreferrer"
            class="bg-[#E4405F] text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors inline-flex items-center"
            aria-label="Follow us on Instagram"
          >
            <i class="fa-brands fa-instagram mr-2"></i>
            Instagram
          </a>
          <a 
            href={`mailto:?subject=${encodeURIComponent(post.data.title)}&body=${encodeURIComponent(`Check out this article: ${Astro.url.href}`)}`}
            class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors inline-flex items-center"
            aria-label="Share via Email"
          >
            <i class="fa-solid fa-envelope mr-2"></i>
            Email
          </a>
        </div>
      </div>
    </div>
  </article>

  <!-- Related Articles -->
  <section class="bg-gray-50 py-16">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-8">Related Articles</h2>
      <!-- Add related articles logic here -->
    </div>
  </section>

  <!-- CTA Section -->
  <section class="bg-primary py-16">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl font-bold text-white mb-6">Need Expert Advice?</h2>
      <p class="text-xl text-white mb-8">Our team is here to help you implement these solutions on your farm.</p>
      <a 
        href="/contact" 
        class="bg-white text-primary px-8 py-3 rounded-full text-lg hover:bg-opacity-90 inline-flex items-center"
      >
        Contact Us
        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
        </svg>
      </a>
    </div>
  </section>
</Layout>